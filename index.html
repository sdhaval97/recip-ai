<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RECIP.AI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for potential future data visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons for UI elements -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Placeholder Comments -->
    <!-- Chosen Palette: Mint & Stone -->
    <!-- Application Structure Plan: A single-page application with a tab-based navigation system. The UI has a fixed header and a fixed bottom navigation bar. The main content area dynamically switches between three views: 'Inventory', 'Recipes', and 'To Buy'. This structure is chosen for its simplicity and mobile-first user experience, allowing users to quickly switch between the core tasks of managing ingredients, finding recipes, and viewing their shopping list without leaving the main screen. The user flow is designed to be intuitive: Add items to inventory -> Generate recipes based on inventory -> Select a recipe to cook -> Used items are automatically moved to the 'To Buy' list. -->
    <!-- Visualization & Content Choices: The application will primarily use structured HTML and CSS (via Tailwind) to create clear, readable lists and forms for the inventory and shopping list. The recipe section will use a card-based layout to present generated options. No complex charts are needed for the core functionality. All interactions, such as switching views and managing data, will be handled by vanilla JavaScript to ensure the application is lightweight and fast. The goal is clarity and efficient task-completion. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        .page.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .prose p { margin-bottom: 1em; }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app-container" class="max-w-lg mx-auto min-h-screen flex flex-col shadow-2xl bg-white">

        <!-- App Header -->
        <header class="bg-white shadow-md sticky top-0 z-10 border-b border-gray-200 text-center">
            <div class="px-4 py-3">
                <div class="flex items-center justify-center">
                    <div data-lucide="chef-hat" class="text-green-500 h-7 w-7 mr-2"></div>
                    <h1 class="text-2xl font-bold text-gray-800 tracking-tight">RECIP.AI</h1>
                </div>
                <h2 id="page-subtitle" class="text-sm font-medium text-gray-500">My Inventory</h2>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow p-4 md:p-6 overflow-y-auto">
            
            <!-- Inventory Page -->
            <div id="inventory-page" class="page active">
                <form id="add-item-form" class="p-4 bg-gray-100 rounded-lg shadow-sm mb-6">
                    <div class="grid grid-cols-1 sm:grid-cols-5 gap-3">
                        <input type="text" id="item-name" placeholder="Item name" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 col-span-1 sm:col-span-2" required>
                        <input type="number" id="item-quantity" placeholder="Qty" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 col-span-1" required>
                        <select id="item-unit" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 col-span-1 bg-white">
                            <option value="">- Unit -</option>
                            <option value="pcs">pcs</option>
                            <option value="kg">kg</option>
                            <option value="g">g</option>
                            <option value="litre">litre</option>
                            <option value="ml">ml</option>
                            <option value="lbs">lbs</option>
                            <option value="oz">oz</option>
                        </select>
                        <button type="submit" class="bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center shadow col-span-1">
                            <div data-lucide="plus-circle" class="h-6 w-6"></div>
                        </button>
                    </div>
                </form>
                <ul id="inventory-list" class="space-y-3"></ul>
                 <div id="inventory-placeholder" class="text-center py-10 px-4 bg-gray-50 rounded-lg">
                    <div data-lucide="list" class="mx-auto h-12 w-12 text-gray-400"></div>
                    <h3 class="mt-4 text-lg font-semibold text-gray-700">Your inventory is empty</h3>
                    <p class="mt-1 text-gray-500">Add some items you have at home to get started.</p>
                </div>
            </div>

            <!-- Recipe Page -->
            <div id="recipe-page" class="page">
                 <div id="recipe-generator-view">
                    <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                        <div class="flex flex-col sm:flex-row gap-4 items-center">
                            <select id="recipe-preference" class="w-full sm:w-auto flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="surprise me">Surprise Me</option>
                                <option value="veg">Vegetarian</option>
                                <option value="non-veg">Non-Vegetarian</option>
                            </select>
                            <button id="generate-recipes-btn" class="w-full sm:w-auto bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed shadow">
                                <div id="generate-btn-icon" data-lucide="sparkles" class="h-5 w-5"></div>
                                <span id="generate-btn-text">Generate Recipes</span>
                            </button>
                        </div>
                        <p id="recipe-warning" class="text-center text-sm text-yellow-700 mt-3 bg-yellow-100 p-2 rounded-md hidden">Add at least 2 items to your inventory to find recipes.</p>
                    </div>
                    <div id="recipes-container" class="space-y-4"></div>
                    <button id="regenerate-btn" class="hidden mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors flex items-center justify-center gap-2">
                        <div data-lucide="refresh-cw" class="h-5 w-5"></div>
                        Try Again
                    </button>
                    <div id="recipe-placeholder" class="text-center py-10 px-4 bg-gray-50 rounded-lg">
                        <div data-lucide="utensils-crossed" class="mx-auto h-12 w-12 text-gray-400"></div>
                        <h3 class="mt-4 text-lg font-semibold text-gray-700">Ready to cook?</h3>
                        <p class="mt-1 text-gray-500">Select a preference and click "Generate Recipes" to find meals you can make.</p>
                    </div>
                 </div>
                 <div id="recipe-detail-view" class="hidden"></div>
            </div>

            <!-- To Buy Page -->
            <div id="to-buy-page" class="page">
                <ul id="shopping-list" class="space-y-3 mb-6"></ul>
                 <div id="shopping-list-placeholder" class="text-center py-10 px-4 bg-gray-50 rounded-lg">
                    <div data-lucide="shopping-cart" class="mx-auto h-12 w-12 text-gray-400"></div>
                    <h3 class="mt-4 text-lg font-semibold text-gray-700">Shopping list is empty</h3>
                    <p class="mt-1 text-gray-500">When you use up an ingredient, it will be added here.</p>
                </div>
                <button id="clear-shopping-list-btn" class="w-full bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center gap-2 shadow hidden">
                    <div data-lucide="trash-2" class="h-5 w-5"></div>
                    Clear Shopping List
                </button>
            </div>

        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="bg-white shadow-t-md sticky bottom-0 z-10 border-t border-gray-200">
            <div class="px-4 py-2 flex justify-around">
                <button data-page="inventory-page" class="nav-button flex flex-col items-center justify-center w-24 p-2 rounded-lg text-green-600 bg-green-50">
                    <div data-lucide="list" class="h-6 w-6 mb-1"></div>
                    <span class="text-xs font-medium">Inventory</span>
                </button>
                <button data-page="recipe-page" class="nav-button flex flex-col items-center justify-center w-24 p-2 rounded-lg text-gray-500 hover:bg-gray-100">
                    <div data-lucide="utensils-crossed" class="h-6 w-6 mb-1"></div>
                    <span class="text-xs font-medium">Recipes</span>
                </button>
                <button data-page="to-buy-page" class="nav-button flex flex-col items-center justify-center w-24 p-2 rounded-lg text-gray-500 hover:bg-gray-100">
                    <div data-lucide="shopping-cart" class="h-6 w-6 mb-1"></div>
                    <span class="text-xs font-medium">To Buy</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let inventory = [];
            let shoppingList = [];
            let currentRecipes = [];

            // --- DOM ELEMENT REFERENCES ---
            const navButtons = document.querySelectorAll('.nav-button');
            const pages = document.querySelectorAll('.page');
            const pageSubtitle = document.getElementById('page-subtitle');
            
            const addItemForm = document.getElementById('add-item-form');
            const inventoryList = document.getElementById('inventory-list');
            const inventoryPlaceholder = document.getElementById('inventory-placeholder');
            
            const generateRecipesBtn = document.getElementById('generate-recipes-btn');
            const generateBtnText = document.getElementById('generate-btn-text');
            const generateBtnIcon = document.getElementById('generate-btn-icon');
            const recipePreference = document.getElementById('recipe-preference');
            const recipeWarning = document.getElementById('recipe-warning');
            const recipesContainer = document.getElementById('recipes-container');
            const recipePlaceholder = document.getElementById('recipe-placeholder');
            const recipeGeneratorView = document.getElementById('recipe-generator-view');
            const recipeDetailView = document.getElementById('recipe-detail-view');
            const regenerateBtn = document.getElementById('regenerate-btn');

            const shoppingListEl = document.getElementById('shopping-list');
            const shoppingListPlaceholder = document.getElementById('shopping-list-placeholder');
            const clearShoppingListBtn = document.getElementById('clear-shopping-list-btn');

            const pageSubtitles = {
                'inventory-page': 'My Inventory',
                'recipe-page': 'Recipe Finder',
                'to-buy-page': 'Shopping List'
            };

            // --- RENDER FUNCTIONS ---
            const renderInventory = () => {
                inventoryList.innerHTML = '';
                inventoryPlaceholder.style.display = inventory.length === 0 ? 'block' : 'none';
                generateRecipesBtn.disabled = inventory.length < 2;
                recipeWarning.classList.toggle('hidden', inventory.length >= 2);

                inventory.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center justify-between bg-white p-4 rounded-lg shadow-sm';
                    const unitText = item.unit ? ` ${item.unit}` : '';
                    li.innerHTML = `
                        <div>
                            <span class="text-gray-800 font-bold capitalize">${item.name}</span>
                            <span class="text-gray-500 text-sm ml-2">${item.quantity}${unitText}</span>
                        </div>
                        <button class="delete-item-btn text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100" data-id="${item.id}">
                            <div data-lucide="trash-2" class="h-5 w-5"></div>
                        </button>`;
                    inventoryList.appendChild(li);
                });
                lucide.createIcons();
            };

            const renderShoppingList = () => {
                shoppingListEl.innerHTML = '';
                shoppingListPlaceholder.style.display = shoppingList.length === 0 ? 'block' : 'none';
                clearShoppingListBtn.classList.toggle('hidden', shoppingList.length === 0);

                shoppingList.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'bg-white p-3 rounded-lg shadow-sm flex items-center';
                    const unitText = item.unit ? ` ${item.unit}` : '';
                    li.innerHTML = `
                        <input type="checkbox" id="item-${item.id}" data-id="${item.id}" class="shopping-item-checkbox h-5 w-5 rounded border-gray-300 text-green-600 focus:ring-green-500 mr-4">
                        <label for="item-${item.id}" class="flex-grow">
                            <span class="text-gray-800 font-bold capitalize">${item.name}</span>
                            <span class="text-gray-500 text-sm ml-2">${item.purchaseQuantity}${unitText}</span>
                        </label>`;
                    shoppingListEl.appendChild(li);
                });
            };

            const renderRecipes = (recipes) => {
                recipesContainer.innerHTML = '';
                recipePlaceholder.style.display = 'none';
                regenerateBtn.classList.remove('hidden');
                currentRecipes = recipes;

                recipes.forEach((recipe, index) => {
                    const card = document.createElement('div');
                    card.className = 'bg-white p-5 rounded-lg shadow-sm border border-gray-200';
                    const ingredientsHtml = recipe.ingredients.map(ing => {
                        return `<li class="bg-gray-100 text-gray-700 text-sm font-medium px-3 py-1 rounded-full">${ing.name}</li>`;
                    }).join('');

                    card.innerHTML = `
                        <h4 class="text-lg font-bold text-green-700 capitalize">${recipe.recipeName}</h4>
                        <p class="text-sm text-gray-500 mt-2 mb-3">Uses:</p>
                        <ul class="flex flex-wrap gap-2">${ingredientsHtml}</ul>
                        <button data-recipe-index="${index}" class="cook-this-btn mt-4 w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600">
                            Cook This
                        </button>`;
                    recipesContainer.appendChild(card);
                });
            };

            const renderRecipeDetail = (recipe) => {
                recipeGeneratorView.style.display = 'none';
                recipeDetailView.style.display = 'block';
                recipeDetailView.dataset.recipe = JSON.stringify(recipe);
                
                const ingredientsHtml = recipe.ingredients.map(ing => {
                    const unitText = ing.unit ? ` ${ing.unit}` : '';
                    return `<li class="text-gray-800 capitalize">${ing.quantity}${unitText} ${ing.name}</li>`;
                }).join('');

                const instructionsHtml = recipe.instructions.split('\n').filter(step => step.trim() !== '').map(step => `<li>${step}</li>`).join('');

                recipeDetailView.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <button id="back-to-recipes-btn" class="flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-semibold mb-4">
                            <div data-lucide="arrow-left" class="h-4 w-4"></div>
                            Back to Recipes
                        </button>
                        <h3 class="text-3xl font-bold text-green-700 capitalize mb-4">${recipe.recipeName}</h3>
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Ingredients:</h4>
                            <ul class="list-disc list-inside bg-gray-50 p-4 rounded-md space-y-1">${ingredientsHtml}</ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Instructions:</h4>
                            <ul class="list-disc list-inside bg-gray-50 p-4 rounded-md space-y-2">${instructionsHtml}</ul>
                        </div>
                        <button id="im-done-btn" class="mt-6 w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600">
                            I'm Done Cooking!
                        </button>
                    </div>`;
                lucide.createIcons();
            };

            const setLoadingState = (isLoading) => {
                generateRecipesBtn.disabled = isLoading;
                regenerateBtn.disabled = isLoading;
                if (isLoading) {
                    generateBtnText.textContent = 'Generating...';
                    generateBtnIcon.innerHTML = `<div class="spinner h-5 w-5 border-2 border-t-transparent border-white rounded-full"></div>`;
                } else {
                    generateBtnText.textContent = 'Generate Recipes';
                    generateBtnIcon.innerHTML = `<div data-lucide="sparkles" class="h-5 w-5"></div>`;
                    lucide.createIcons();
                }
            };
            
            // --- EVENT HANDLERS ---
            const handleAddItem = (e) => {
                e.preventDefault();
                const nameInput = document.getElementById('item-name');
                const quantityInput = document.getElementById('item-quantity');
                const unitInput = document.getElementById('item-unit');

                const newItem = {
                    id: Date.now(),
                    name: nameInput.value,
                    quantity: parseFloat(quantityInput.value),
                    unit: unitInput.value.trim(),
                    purchaseQuantity: parseFloat(quantityInput.value),
                };

                inventory.push(newItem);
                renderInventory();
                addItemForm.reset();
            };

            const handleDeleteItem = (e) => {
                if (e.target.closest('.delete-item-btn')) {
                    const button = e.target.closest('.delete-item-btn');
                    const itemId = parseInt(button.dataset.id);
                    inventory = inventory.filter(item => item.id !== itemId);
                    renderInventory();
                }
            };
            
            const handleGenerateRecipes = async () => {
                setLoadingState(true);
                recipesContainer.innerHTML = '';
                recipePlaceholder.style.display = 'none';

                const ingredientsList = inventory.map(item => {
                    const unitText = item.unit ? ` ${item.unit}` : '';
                    return `${item.quantity}${unitText} of ${item.name}`;
                }).join(', ');
                
                const preference = recipePreference.value;

                const prompt = `You are a helpful chef. Based on the following ingredients I have: ${ingredientsList}, generate 3 unique ${preference} recipe ideas portioned for one person. Assume I have basic pantry staples like salt, pepper, oil, and common spices. For each recipe, provide: 1. A 'recipeName' (string). 2. An 'ingredients' list (array of objects with name, quantity, unit) using ONLY the main ingredients from my list. 3. A single string for 'instructions' with concise, step-by-step cooking directions, separating each step with '\\n'.`;
                
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    recipeName: { type: "STRING" },
                                    ingredients: {
                                        type: "ARRAY",
                                        items: {
                                            type: "OBJECT",
                                            properties: {
                                                name: { type: "STRING" },
                                                quantity: { type: "NUMBER" },
                                                unit: { type: "STRING" }
                                            },
                                            required: ["name", "quantity", "unit"]
                                        }
                                    },
                                    instructions: { type: "STRING" }
                                },
                                required: ["recipeName", "ingredients", "instructions"]
                            }
                        }
                    }
                };

                try {
                    // --- IMPORTANT: PASTE YOUR API KEY HERE ---
                    const apiKey = import.meta.env.VITE_GEMINI_API_KEY;
                    // -----------------------------------------

                    if (apiKey === import.meta.env.VITE_GEMINI_API_KEY || !apiKey) {
                        throw new Error("API Key is missing. Please add your Gemini API key.");
                    }

                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates[0].content.parts[0].text) {
                        const parsedRecipes = JSON.parse(result.candidates[0].content.parts[0].text);
                        renderRecipes(parsedRecipes);
                    } else {
                        throw new Error("Could not parse recipes from AI response.");
                    }
                } catch (err) {
                    console.error("Error generating recipes:", err);
                    recipesContainer.innerHTML = `<p class="text-center text-red-500">${err.message}</p>`;
                } finally {
                    setLoadingState(false);
                }
            };

            const handleCookThis = (e) => {
                if (e.target.classList.contains('cook-this-btn')) {
                    const recipeIndex = parseInt(e.target.dataset.recipeIndex);
                    const selectedRecipe = currentRecipes[recipeIndex];
                    if (selectedRecipe) {
                        renderRecipeDetail(selectedRecipe);
                    }
                }
            };
            
            const handleDoneCooking = () => {
                const recipe = JSON.parse(recipeDetailView.dataset.recipe);
                
                recipe.ingredients.forEach(usedIng => {
                    const invItem = inventory.find(item => item.name.toLowerCase() === usedIng.name.toLowerCase());
                    if (invItem) {
                        invItem.quantity -= usedIng.quantity;
                        if (invItem.quantity <= 0) {
                            shoppingList.push(invItem);
                            inventory = inventory.filter(item => item.id !== invItem.id);
                        }
                    }
                });

                renderInventory();
                renderShoppingList();
                
                recipeDetailView.style.display = 'none';
                recipeGeneratorView.style.display = 'block';
                recipesContainer.innerHTML = '';
                regenerateBtn.classList.add('hidden');
                recipePlaceholder.style.display = 'block';
            };

            const handleBuyItem = (e) => {
                if (e.target.classList.contains('shopping-item-checkbox')) {
                    const checkbox = e.target;
                    const itemId = parseInt(checkbox.dataset.id);
                    
                    const itemToMove = shoppingList.find(item => item.id === itemId);
                    if (itemToMove) {
                        // Restore original quantity and move to inventory
                        itemToMove.quantity = itemToMove.purchaseQuantity;
                        inventory.push(itemToMove);
                        
                        // Remove from shopping list
                        shoppingList = shoppingList.filter(item => item.id !== itemId);
                        
                        // Re-render both lists
                        renderInventory();
                        renderShoppingList();
                    }
                }
            };

            const switchPage = (targetPageId) => {
                pages.forEach(page => page.classList.remove('active'));
                navButtons.forEach(btn => {
                    btn.classList.remove('text-green-600', 'bg-green-50');
                    btn.classList.add('text-gray-500', 'hover:bg-gray-100');
                });

                document.getElementById(targetPageId).classList.add('active');
                const activeButton = document.querySelector(`.nav-button[data-page="${targetPageId}"]`);
                activeButton.classList.add('text-green-600', 'bg-green-50');
                activeButton.classList.remove('text-gray-500', 'hover:bg-gray-100');

                pageSubtitle.textContent = pageSubtitles[targetPageId];
            };

            // --- EVENT LISTENERS ---
            navButtons.forEach(button => {
                button.addEventListener('click', () => switchPage(button.dataset.page));
            });

            addItemForm.addEventListener('submit', handleAddItem);
            inventoryList.addEventListener('click', handleDeleteItem);
            generateRecipesBtn.addEventListener('click', handleGenerateRecipes);
            regenerateBtn.addEventListener('click', handleGenerateRecipes);
            recipesContainer.addEventListener('click', handleCookThis);
            shoppingListEl.addEventListener('change', handleBuyItem);
            
            recipeDetailView.addEventListener('click', (e) => {
                if (e.target.id === 'back-to-recipes-btn' || e.target.closest('#back-to-recipes-btn')) {
                    recipeDetailView.style.display = 'none';
                    recipeGeneratorView.style.display = 'block';
                }
                if (e.target.id === 'im-done-btn') {
                    handleDoneCooking();
                }
            });

            clearShoppingListBtn.addEventListener('click', () => {
                shoppingList = [];
                renderShoppingList();
            });

            // --- INITIALIZATION ---
            lucide.createIcons();
            renderInventory();
            renderShoppingList();
        });
    </script>
</body>
</html>
